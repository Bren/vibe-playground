<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Pixel Options - drorbren.com</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            padding: 0 20px;
        }
        
        h1 {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .nav {
            margin-bottom: 3rem;
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav a:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .celebrity-selector {
            margin: 2rem 0;
        }
        
        .celebrity-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 1rem 0;
        }
        
        .celebrity-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .celebrity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .celebrity-btn.selected {
            background: #4caf50;
            border-color: #4caf50;
        }
        
        .current-celebrity {
            margin: 2rem 0;
            text-align: center;
        }
        
        .reference-photo {
            margin: 1rem 0;
        }
        
        
        .controls {
            margin: 2rem 0;
        }
        
        .btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn.secondary {
            background: #ff9800;
        }
        
        .btn.secondary:hover {
            background: #e68900;
        }
        
        .btn.danger {
            background: #f44336;
        }
        
        .btn.danger:hover {
            background: #da190b;
        }
        
        .info {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: left;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .pixel-grid {
                grid-template-columns: repeat(8, 1fr);
                max-width: 300px;
            }
            
            .nav a {
                display: block;
                margin: 0.5rem 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="index.html">Home</a>
            <a href="logic-crossword.html">Logic Crossword</a>
            <a href="pixel-options.html">Pixel Options</a>
        </nav>
        
        <h1>Pixel Options</h1>
        
        <div class="content">
            <h2>Celebrity Pixel Art Creator</h2>
            <p>Create pixelated versions of famous people for your guessing game!</p>
            
            <div class="celebrity-selector">
                <h3>Choose a Celebrity (New Options Only):</h3>
                <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-bottom: 1rem;">
                    These celebrities are NOT in your existing list yet
                </p>
                <div class="celebrity-options" id="celebrityOptions">
                    <!-- Celebrity buttons will be generated dynamically -->
                </div>
            </div>
            
            <div class="current-celebrity" id="currentCelebrity" style="display: none;">
                <h3 id="celebrityName">Selected Celebrity</h3>
                <div class="reference-photo">
                    <img id="referenceImage" src="" alt="Reference photo" style="max-width: 200px; border-radius: 10px; margin: 10px;">
                </div>
                
                <!-- Pixel Art Generation Section -->
                <div class="pixel-art-section" style="margin-top: 2rem;">
                    <h4>üé® Pixel Art Generator</h4>
                    <div class="pixel-controls" style="margin: 1rem 0;">
                        <label for="pixelSize">Pixel Size:</label>
                        <input type="range" id="pixelSize" min="4" max="20" value="8" style="margin: 0 1rem;">
                        <span id="pixelSizeValue">8px</span>
                        
                        <label for="pixelColors" style="margin-left: 2rem;">Colors:</label>
                        <select id="pixelColors" style="margin-left: 0.5rem;">
                            <option value="16">16 colors</option>
                            <option value="32" selected>32 colors</option>
                            <option value="64">64 colors</option>
                            <option value="128">128 colors</option>
                        </select>
                        
                        <button class="btn" onclick="generatePixelArt()" style="margin-left: 2rem;">Generate Pixel Art</button>
                    </div>
                    
                    <div class="pixel-art-output" id="pixelArtOutput" style="display: none;">
                        <h5>Generated Pixel Art:</h5>
                        <div class="pixel-canvas-container" style="background: white; padding: 20px; border-radius: 10px; display: inline-block;">
                            <canvas id="pixelCanvas" style="border: 1px solid #ccc; image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges;"></canvas>
                        </div>
                        <div class="pixel-actions" style="margin-top: 1rem;">
                            <button class="btn" onclick="downloadPixelArt()">Download PNG</button>
                            <button class="btn secondary" onclick="copyPixelArtData()">Copy Pixel Data</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="exportForGame()">Export for Game</button>
                <button class="btn secondary" onclick="loadFromGoogleSheets()">Refresh from Google Sheets</button>
                <button class="btn secondary" onclick="addToGoogleSheets()">Add to Google Sheets</button>
            </div>
            
            <div class="filter-info" id="filterInfo" style="display: none; margin: 1rem 0; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 5px;">
                <h4>üìä Filter Results:</h4>
                <p id="filterStats"></p>
            </div>
            
            <div class="export-info" id="exportInfo" style="display: none;">
                <h3>Export Data:</h3>
                <textarea id="exportData" readonly style="width: 100%; height: 100px; background: rgba(0,0,0,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; padding: 10px; font-family: monospace;"></textarea>
                <button class="btn" onclick="copyToClipboard()">Copy to Clipboard</button>
            </div>
            
            <div class="info">
                <h3>How to use:</h3>
                <ul>
                    <li><strong>Select a celebrity</strong> from the options above</li>
                    <li><strong>View the reference photo</strong> to see the person</li>
                    <li><strong>Export for Game</strong> - Get the celebrity data in game format</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // This will be populated from Google Sheets data
        let existingCelebrities = [];
        let allExistingNames = new Set(); // All names and nicknames from Google Sheets

        // Celebrity data with reference photos and basic templates (only NEW ones not in your list)
        const celebrities = {
            // TEST: Einstein (should be filtered out)
            einstein_test: {
                name: '◊ê◊ú◊ë◊®◊ò ◊ê◊ô◊†◊©◊ò◊ô◊ô◊ü',
                alternatives: ['◊ê◊ô◊†◊©◊ò◊ô◊ô◊ü', '◊ê◊ú◊ë◊®◊ò', 'Albert Einstein', 'Einstein'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/d/d3/Albert_Einstein_Head.jpg'
            },
            // International celebrities
            gandhi: {
                name: '◊û◊î◊ò◊û◊î ◊í◊†◊ì◊ô',
                alternatives: ['◊í◊†◊ì◊ô', '◊û◊î◊ò◊û◊î', 'Mahatma Gandhi', 'Gandhi'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Mahatma-Gandhi%2C_studio%2C_1931.jpg/800px-Mahatma-Gandhi%2C_studio%2C_1931.jpg'
            },
            mandela: {
                name: '◊†◊ú◊°◊ï◊ü ◊û◊†◊ì◊ú◊î',
                alternatives: ['◊û◊†◊ì◊ú◊î', '◊†◊ú◊°◊ï◊ü', 'Nelson Mandela', 'Mandela'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Nelson_Mandela_1994.jpg/800px-Nelson_Mandela_1994.jpg'
            },
            mother_teresa: {
                name: '◊ê◊ù ◊™◊®◊ñ◊î',
                alternatives: ['◊™◊®◊ñ◊î', '◊ê◊ù', 'Mother Teresa', 'Teresa'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Mother_Teresa_1.jpg/800px-Mother_Teresa_1.jpg'
            },
            da_vinci: {
                name: '◊ú◊ê◊ï◊†◊®◊ì◊ï ◊ì◊î ◊ï◊ô◊†◊¶\'◊ô',
                alternatives: ['◊ì◊î ◊ï◊ô◊†◊¶\'◊ô', '◊ú◊ê◊ï◊†◊®◊ì◊ï', 'Leonardo da Vinci', 'da Vinci'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/ba/Leonardo_self.jpg/800px-Leonardo_self.jpg'
            },
            mozart: {
                name: '◊ï◊ï◊ú◊§◊í◊†◊í ◊ê◊û◊ì◊ê◊ï◊° ◊û◊ï◊¶◊®◊ò',
                alternatives: ['◊û◊ï◊¶◊®◊ò', '◊ï◊ï◊ú◊§◊í◊†◊í', 'Wolfgang Amadeus Mozart', 'Mozart'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/Wolfgang-amadeus-mozart_1.jpg/800px-Wolfgang-amadeus-mozart_1.jpg'
            },
            shakespeare: {
                name: '◊ï◊ô◊ú◊ô◊ê◊ù ◊©◊ô◊ô◊ß◊°◊§◊ô◊®',
                alternatives: ['◊©◊ô◊ô◊ß◊°◊§◊ô◊®', '◊ï◊ô◊ú◊ô◊ê◊ù', 'William Shakespeare', 'Shakespeare'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Shakespeare.jpg/800px-Shakespeare.jpg'
            },
            // Modern celebrities
            elon_musk: {
                name: '◊ê◊ô◊ú◊ï◊ü ◊û◊ê◊°◊ß',
                alternatives: ['◊û◊ê◊°◊ß', '◊ê◊ô◊ú◊ï◊ü', 'Elon Musk', 'Musk'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Elon_Musk_Royal_Society_%28crop2%29.jpg/800px-Elon_Musk_Royal_Society_%28crop2%29.jpg'
            },
            steve_jobs: {
                name: '◊°◊ò◊ô◊ë ◊í\'◊ï◊ë◊°',
                alternatives: ['◊í\'◊ï◊ë◊°', '◊°◊ò◊ô◊ë', 'Steve Jobs', 'Jobs'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f5/Steve_Jobs_Headshot_2010-CROP_%28cropped_2%29.jpg/800px-Steve_Jobs_Headshot_2010-CROP_%28cropped_2%29.jpg'
            },
            bill_gates: {
                name: '◊ë◊ô◊ú ◊í◊ô◊ô◊ò◊°',
                alternatives: ['◊í◊ô◊ô◊ò◊°', '◊ë◊ô◊ú', 'Bill Gates', 'Gates'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/Bill_Gates_2018.jpg/800px-Bill_Gates_2018.jpg'
            },
            // Entertainment
            elvis: {
                name: '◊ê◊ú◊ë◊ô◊° ◊§◊®◊°◊ú◊ô',
                alternatives: ['◊§◊®◊°◊ú◊ô', '◊ê◊ú◊ë◊ô◊°', 'Elvis Presley', 'Elvis'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Elvis_Presley_1969.jpg/800px-Elvis_Presley_1969.jpg'
            },
            michael_jackson: {
                name: '◊û◊ô◊ô◊ß◊ú ◊í\'◊ß◊°◊ï◊ü',
                alternatives: ['◊í\'◊ß◊°◊ï◊ü', '◊û◊ô◊ô◊ß◊ú', 'Michael Jackson', 'Jackson'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Michael_Jackson_in_1988.jpg/800px-Michael_Jackson_in_1988.jpg'
            },
            madonna: {
                name: '◊û◊ì◊ï◊†◊î',
                alternatives: ['Madonna', '◊û◊ì◊ï◊†◊î'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Madonna_-_Rebel_Heart_Tour_2015_-_Stockholm_%2823058147220%29_%28cropped%29.jpg/800px-Madonna_-_Rebel_Heart_Tour_2015_-_Stockholm_%2823058147220%29_%28cropped%29.jpg'
            },
            // Sports
            muhammad_ali: {
                name: '◊û◊ï◊ó◊û◊ì ◊¢◊ú◊ô',
                alternatives: ['◊¢◊ú◊ô', '◊û◊ï◊ó◊û◊ì', 'Muhammad Ali', 'Ali'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Muhammad_Ali_NYWTS.jpg/800px-Muhammad_Ali_NYWTS.jpg'
            },
            pele: {
                name: '◊§◊ú◊î',
                alternatives: ['Pele', '◊§◊ú◊î'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Pele_con_brasil_%28cropped%29.jpg/800px-Pele_con_brasil_%28cropped%29.jpg'
            },
            // Science
            newton: {
                name: '◊ê◊ô◊ô◊ñ◊ß ◊†◊ô◊ï◊ò◊ï◊ü',
                alternatives: ['◊†◊ô◊ï◊ò◊ï◊ü', '◊ê◊ô◊ô◊ñ◊ß', 'Isaac Newton', 'Newton'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Portrait_of_Sir_Isaac_Newton%2C_1689.jpg/800px-Portrait_of_Sir_Isaac_Newton%2C_1689.jpg'
            },
            darwin: {
                name: '◊¶\'◊ê◊®◊ú◊° ◊ì◊®◊ï◊ï◊ô◊ü',
                alternatives: ['◊ì◊®◊ï◊ï◊ô◊ü', '◊¶\'◊ê◊®◊ú◊°', 'Charles Darwin', 'Darwin'],
                photo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Charles_Darwin_seated_crop.jpg/800px-Charles_Darwin_seated_crop.jpg'
            }
        };
        
        let currentCelebrity = null;
        
        // Select a celebrity
        function selectCelebrity(celebrityId) {
            currentCelebrity = celebrityId;
            const celebrity = celebrities[celebrityId];
            
            // Update UI
            document.getElementById('celebrityName').textContent = celebrity.name;
            document.getElementById('referenceImage').src = celebrity.photo;
            document.getElementById('currentCelebrity').style.display = 'block';
            
            // Update button states
            document.querySelectorAll('.celebrity-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }
        
        // Export data for the game
        function exportForGame() {
            if (!currentCelebrity) {
                alert('Please select a celebrity first!');
                return;
            }
            
            const exportData = {
                celebrity: celebrities[currentCelebrity].name,
                alternatives: celebrities[currentCelebrity].alternatives,
                celebrityId: currentCelebrity,
                photo: celebrities[currentCelebrity].photo,
                timestamp: new Date().toISOString()
            };
            
            document.getElementById('exportData').value = JSON.stringify(exportData, null, 2);
            document.getElementById('exportInfo').style.display = 'block';
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            const exportData = document.getElementById('exportData');
            exportData.select();
            document.execCommand('copy');
            alert('Data copied to clipboard!');
        }
        
        // Generate celebrity buttons dynamically
        function generateCelebrityButtons() {
            const container = document.getElementById('celebrityOptions');
            container.innerHTML = '';
            
            Object.keys(celebrities).forEach(celebrityId => {
                const celebrity = celebrities[celebrityId];
                const button = document.createElement('button');
                button.className = 'celebrity-btn';
                button.textContent = celebrity.name;
                button.onclick = () => selectCelebrity(celebrityId);
                container.appendChild(button);
            });
        }
        
        // Google Sheets configuration
        const GOOGLE_SHEETS_CONFIG = {
            sheetId: '1GgoGvCzW74vSqoaQeQmeGYEdNvLMY64iklDjCTYYOcY',
            sheetName: 'Sheet1', // You can change this to your actual sheet name
            // Note: For security, credentials should be loaded from a secure backend service
            // or environment variables, not hardcoded in the frontend
        };

        // Load data from Google Sheets and build comprehensive name list
        async function loadFromGoogleSheets() {
            try {
                const response = await fetch('/.netlify/functions/celebrities');
                const data = await response.json();
                
                if (data.success) {
                    existingCelebrities = data.celebrities;
                    allExistingNames.clear();
                    
                    // Build comprehensive list of all names and nicknames
                    existingCelebrities.forEach(celebrity => {
                        // Add main name
                        const mainName = celebrity.name.toLowerCase().trim();
                        allExistingNames.add(mainName);
                        
                        // Add nicknames if they exist
                        if (celebrity.nicknames) {
                            const nicknames = celebrity.nicknames.split(',').map(n => n.trim());
                            nicknames.forEach(nickname => {
                                if (nickname) {
                                    allExistingNames.add(nickname.toLowerCase().trim());
                                }
                            });
                        }
                        
                        // Debug: Check if Einstein is being added
                        if (celebrity.name.includes('◊ê◊ô◊†◊©◊ò◊ô◊ô◊ü')) {
                            console.log('üîç Found Einstein in Google Sheets:', celebrity.name);
                            console.log('üîç Nicknames:', celebrity.nicknames);
                        }
                    });
                    
                    console.log('üìä Built name database with', allExistingNames.size, 'total names');
                    console.log('üîç Checking if Einstein is in database:', allExistingNames.has('◊ê◊ú◊ë◊®◊ò ◊ê◊ô◊†◊©◊ò◊ô◊ô◊ü'));
                    
                    // Filter suggested celebrities to remove any that already exist
                    filterSuggestedCelebrities();
                    
                    // Show the data in the export area
                    document.getElementById('exportData').value = JSON.stringify({
                        source: 'Google Sheets (Live Data)',
                        celebrities: data.celebrities,
                        count: data.count,
                        totalNames: allExistingNames.size,
                        timestamp: new Date().toISOString()
                    }, null, 2);
                    document.getElementById('exportInfo').style.display = 'block';
                    
                    alert(`‚úÖ Loaded ${data.count} celebrities from Google Sheets!\nüìä Total unique names/nicknames: ${allExistingNames.size}`);
                } else {
                    throw new Error(data.error || 'Failed to load data');
                }
                
            } catch (error) {
                console.error('Error loading from Google Sheets:', error);
                alert('‚ùå Error loading from Google Sheets: ' + error.message);
            }
        }
        
        // Filter suggested celebrities to remove duplicates
        function filterSuggestedCelebrities() {
            const originalCount = Object.keys(celebrities).length;
            const filteredCelebrities = {};
            const duplicates = [];
            
            console.log('üîç Starting filter process...');
            console.log('üìä Total existing names:', allExistingNames.size);
            console.log('üìù Original celebrities to check:', originalCount);
            
            Object.keys(celebrities).forEach(celebrityId => {
                const celebrity = celebrities[celebrityId];
                let isDuplicate = false;
                let duplicateReason = '';
                
                console.log(`Checking: ${celebrity.name}`);
                
                // Check if main name exists
                const mainNameLower = celebrity.name.toLowerCase().trim();
                if (allExistingNames.has(mainNameLower)) {
                    isDuplicate = true;
                    duplicateReason = `Main name "${celebrity.name}" already exists`;
                    console.log(`‚ùå DUPLICATE: ${duplicateReason}`);
                }
                
                // Check if any alternatives exist
                if (!isDuplicate && celebrity.alternatives) {
                    for (const alt of celebrity.alternatives) {
                        const altLower = alt.toLowerCase().trim();
                        if (allExistingNames.has(altLower)) {
                            isDuplicate = true;
                            duplicateReason = `Alternative name "${alt}" already exists`;
                            console.log(`‚ùå DUPLICATE: ${duplicateReason}`);
                            break;
                        }
                    }
                }
                
                // Only add if not a duplicate
                if (!isDuplicate) {
                    filteredCelebrities[celebrityId] = celebrity;
                    console.log(`‚úÖ KEEPING: ${celebrity.name}`);
                } else {
                    duplicates.push({ name: celebrity.name, reason: duplicateReason });
                }
            });
            
            // Update the celebrities object with filtered results
            Object.keys(celebrities).forEach(key => delete celebrities[key]);
            Object.assign(celebrities, filteredCelebrities);
            
            // Show filter statistics
            showFilterStats(originalCount, Object.keys(filteredCelebrities).length, duplicates);
            
            // Regenerate buttons
            generateCelebrityButtons();
            
            console.log(`üéØ Filter complete: ${Object.keys(filteredCelebrities).length} remaining out of ${originalCount} original`);
        }
        
        // Show filter statistics
        function showFilterStats(original, remaining, duplicates) {
            const filterInfo = document.getElementById('filterInfo');
            const filterStats = document.getElementById('filterStats');
            
            filterStats.innerHTML = `
                <strong>Original suggestions:</strong> ${original}<br>
                <strong>After filtering:</strong> ${remaining}<br>
                <strong>Filtered out:</strong> ${original - remaining}<br>
                <strong>Total existing names/nicknames:</strong> ${allExistingNames.size}
            `;
            
            if (duplicates.length > 0) {
                filterStats.innerHTML += `<br><br><strong>Duplicates found:</strong><br>`;
                duplicates.slice(0, 5).forEach(dup => {
                    filterStats.innerHTML += `‚Ä¢ ${dup.name} (${dup.reason})<br>`;
                });
                if (duplicates.length > 5) {
                    filterStats.innerHTML += `‚Ä¢ ... and ${duplicates.length - 5} more`;
                }
            }
            
            filterInfo.style.display = 'block';
        }

        // Add current celebrity to Google Sheets
        async function addToGoogleSheets() {
            if (!currentCelebrity) {
                alert('Please select a celebrity first!');
                return;
            }

            const celebrity = celebrities[currentCelebrity];

            try {
                const response = await fetch('/.netlify/functions/add-celebrity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: celebrity.name,
                        photo: celebrity.photo,
                        alternatives: celebrity.alternatives
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    // Show the added data
                    document.getElementById('exportData').value = JSON.stringify({
                        action: 'Added to Google Sheets',
                        celebrity: celebrity.name,
                        photo: celebrity.photo,
                        alternatives: celebrity.alternatives,
                        result: data,
                        timestamp: new Date().toISOString()
                    }, null, 2);
                    document.getElementById('exportInfo').style.display = 'block';
                    
                    alert(`‚úÖ Successfully added "${celebrity.name}" to Google Sheets!`);
                } else {
                    throw new Error(data.error || 'Failed to add celebrity');
                }
                
            } catch (error) {
                console.error('Error adding to Google Sheets:', error);
                alert('‚ùå Error adding to Google Sheets: ' + error.message);
            }
        }

        // Pixel Art Generation Functions
        
        // Update pixel size display
        document.getElementById('pixelSize').addEventListener('input', function() {
            document.getElementById('pixelSizeValue').textContent = this.value + 'px';
        });
        
        // Generate pixel art from the reference image
        function generatePixelArt() {
            if (!currentCelebrity) {
                alert('Please select a celebrity first!');
                return;
            }
            
            const referenceImg = document.getElementById('referenceImage');
            const canvas = document.getElementById('pixelCanvas');
            const ctx = canvas.getContext('2d');
            
            const pixelSize = parseInt(document.getElementById('pixelSize').value);
            const colorCount = parseInt(document.getElementById('pixelColors').value);
            
            // Create a new image with CORS handling
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                try {
                    // Calculate dimensions (keep aspect ratio, max 128x128 for pixel art)
                    const maxSize = 128;
                    let width = img.naturalWidth;
                    let height = img.naturalHeight;
                    
                    if (width > height) {
                        height = (height * maxSize) / width;
                        width = maxSize;
                    } else {
                        width = (width * maxSize) / height;
                        height = maxSize;
                    }
                    
                    // Set canvas size
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw image to canvas
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Get image data
                    const imageData = ctx.getImageData(0, 0, width, height);
                    const data = imageData.data;
                    
                    // Create pixelated version
                    const pixelatedData = ctx.createImageData(width, height);
                    
                    for (let y = 0; y < height; y += pixelSize) {
                        for (let x = 0; x < width; x += pixelSize) {
                            // Sample color from center of pixel block
                            const centerX = Math.min(x + Math.floor(pixelSize / 2), width - 1);
                            const centerY = Math.min(y + Math.floor(pixelSize / 2), height - 1);
                            const pixelIndex = (centerY * width + centerX) * 4;
                            
                            const r = data[pixelIndex];
                            const g = data[pixelIndex + 1];
                            const b = data[pixelIndex + 2];
                            const a = data[pixelIndex + 3];
                            
                            // Apply color quantization
                            const quantizedColor = quantizeColor(r, g, b, colorCount);
                            
                            // Fill the pixel block
                            for (let py = y; py < Math.min(y + pixelSize, height); py++) {
                                for (let px = x; px < Math.min(x + pixelSize, width); px++) {
                                    const blockIndex = (py * width + px) * 4;
                                    pixelatedData.data[blockIndex] = quantizedColor.r;
                                    pixelatedData.data[blockIndex + 1] = quantizedColor.g;
                                    pixelatedData.data[blockIndex + 2] = quantizedColor.b;
                                    pixelatedData.data[blockIndex + 3] = a;
                                }
                            }
                        }
                    }
                    
                    // Draw pixelated image
                    ctx.putImageData(pixelatedData, 0, 0);
                    
                    // Show the output
                    document.getElementById('pixelArtOutput').style.display = 'block';
                    
                    console.log('üé® Pixel art generated successfully!');
                } catch (error) {
                    console.error('Error generating pixel art:', error);
                    alert('Error generating pixel art. Please try a different image or check console for details.');
                }
            };
            
            img.onerror = function() {
                console.error('Failed to load image for pixel art generation');
                alert('Failed to load image. Please try again or select a different celebrity.');
            };
            
            // Load the image
            img.src = referenceImg.src;
        }
        
        // Color quantization function
        function quantizeColor(r, g, b, colorCount) {
            const step = Math.floor(255 / (colorCount - 1));
            return {
                r: Math.round(r / step) * step,
                g: Math.round(g / step) * step,
                b: Math.round(b / step) * step
            };
        }
        
        // Download pixel art as PNG
        function downloadPixelArt() {
            const canvas = document.getElementById('pixelCanvas');
            const link = document.createElement('a');
            link.download = `${celebrities[currentCelebrity].name.replace(/[^a-zA-Z0-9]/g, '_')}_pixel_art.png`;
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // Copy pixel art data
        function copyPixelArtData() {
            const canvas = document.getElementById('pixelCanvas');
            const pixelSize = document.getElementById('pixelSize').value;
            const colorCount = document.getElementById('pixelColors').value;
            
            const pixelData = {
                celebrity: celebrities[currentCelebrity].name,
                celebrityId: currentCelebrity,
                pixelSize: parseInt(pixelSize),
                colorCount: parseInt(colorCount),
                dimensions: {
                    width: canvas.width,
                    height: canvas.height
                },
                imageData: canvas.toDataURL(),
                timestamp: new Date().toISOString()
            };
            
            document.getElementById('exportData').value = JSON.stringify(pixelData, null, 2);
            document.getElementById('exportInfo').style.display = 'block';
            
            alert('Pixel art data copied to export area!');
        }

        // Initialize when the page loads
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Page loaded, starting initialization...');
            console.log('üìù Initial celebrities count:', Object.keys(celebrities).length);
            
            // First load data from Google Sheets to filter suggestions
            await loadFromGoogleSheets();
            
            console.log('‚úÖ Initialization complete');
        });
    </script>
</body>
</html>
